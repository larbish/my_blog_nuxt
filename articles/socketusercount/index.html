<!DOCTYPE html><html  data-capo=""><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>使用socket实现站点实时在线人数 - s22y&#x27;s webSite</title>
<style>.articleContent>div *{color:#d7ddf1}.articleContent>div blockquote{border-left:4px solid #f4c992;font-size:.9rem;margin:12px 0;padding:12px 24px}.articleContent>div blockquote p{line-height:calc(.8rem + 4px);margin:0}.articleContent>div p{line-height:32px;margin:24px 0}.articleContent>div pre{background-color:#041420;border-radius:12px;margin:12px 0;overflow:scroll;overflow-y:hidden;padding:24px}.articleContent>div pre code{background-color:transparent;font-size:.8rem;margin:0;padding:0}.articleContent>div pre code:after,.articleContent>div pre code:before{content:""}.articleContent>div pre::-webkit-scrollbar{height:0}.articleContent>div code{border-radius:4px;color:#fff;font-size:.9rem;margin:0 4px;padding:2px 4px}.articleContent>div code:before{content:"{ "}.articleContent>div code:after{content:" }"}.articleContent>div img{border-radius:12px;height:auto;margin:24px 0;width:100%}.articleContent>div img:hover{scale:1.1}.articleContent>div h1,.articleContent>div h2,.articleContent>div h3,.articleContent>div h4,.articleContent>div h5,.articleContent>div h6{color:#fff}.articleContent>div h1 a,.articleContent>div h2 a,.articleContent>div h3 a,.articleContent>div h4 a,.articleContent>div h5 a,.articleContent>div h6 a{color:#fff;pointer-events:none;text-decoration:none}.articleContent>div h1{border-bottom:1px dashed #fff;padding-bottom:4px}.articleContent>div ul{margin:24px}.articleContent>div ul li{margin:8px 0}@media (max-width:900px){.articleContent blockquote p{font-size:.7rem}.articleContent p{font-size:.8rem}.articleContent pre code{font-size:.6rem!important}.articleContent code{font-size:.7rem!important}}*{font-family:pointfree,PingFang-l;margin:0;padding:0;transition:.2s}body{background-attachment:fixed;background-color:#091a28;background-image:url(/background.jpg);background-position:100% 0;background-repeat:no-repeat;background-size:cover;color:#ebf4f1}@font-face{font-display:swap;font-family:JB-Medium;src:url(/_nuxt/JetBrainsMono-Medium.3S3k2nMz.woff2)}@font-face{font-display:swap;font-family:PingFang-l;src:url(/_nuxt/PingFang-l.Blv3-Y4q.otf)}@font-face{font-display:swap;font-family:PingFang-m;src:url(/_nuxt/PingFang-m.CC6wB8zs.otf)}@font-face{font-display:swap;font-family:pointfree;src:url(/_nuxt/pointfree.DMu5GJ7t.ttf)}button{background-color:transparent;border:0;outline:none}a{color:#f4c992}a:hover{color:#a85859}html::-webkit-scrollbar{width:10px}html::-webkit-scrollbar-track{display:none}html::-webkit-scrollbar-thumb{background:#e6ddb2;border-radius:2px}html::-webkit-scrollbar-thumb:hover{background:#e5af80;border-radius:2px}html::-webkit-scrollbar-thumb:active{background:#f4c992;border-radius:2px}</style>
<style>.appHeader[data-v-953c1808]{height:100%}.appHeader .content[data-v-953c1808]{align-items:center;display:flex;flex-direction:row;height:100%;justify-content:space-between;margin:0 auto}.appHeader .content .logo[data-v-953c1808]{background-color:#fff;border:1px solid hsla(0,0%,73%,.2);border-radius:14px;height:52px;width:52px}.appHeader .content .articleInfo[data-v-953c1808]{width:100%}.appHeader .content .articleInfo .classification .tags[data-v-953c1808]{margin-right:4px}.appHeader .content .menu[data-v-953c1808]{justify-content:end;width:100%}.appHeader .content .menu[data-v-953c1808],.appHeader .content .menu .mainmenu[data-v-953c1808]{align-items:center;display:flex;flex-direction:row;height:100%}.appHeader .content .menu .mainmenu[data-v-953c1808]{justify-content:center}.appHeader .content .menu .mainmenu .item[data-v-953c1808]{align-items:center;display:flex;flex-direction:row;justify-content:center;list-style:none;margin:0 2px}.appHeader .content .menu .mainmenu .item a[data-v-953c1808]{font-size:1rem;font-weight:700;text-decoration:none}.appHeader .content .menu .mainmenu .item a .icon[data-v-953c1808]{display:none}@media (max-width:900px){.appHeader[data-v-953c1808]{height:48px}.appHeader .content[data-v-953c1808]{padding:0 12px}.appHeader .content .logo[data-v-953c1808]{height:42px;width:42px}.appHeader .content .articleInfo[data-v-953c1808]{display:none}.appHeader .content .menu .mainmenu .item[data-v-953c1808]{margin:0 6px}.appHeader .content .menu .mainmenu .item a[data-v-953c1808]{font-size:.8rem}.appHeader .content .menu .mainmenu .item a .icon[data-v-953c1808]{display:flex;font-size:1.2rem}.appHeader .content .menu .mainmenu .item a .text[data-v-953c1808],.appHeader .content .menu .mainmenu .spot[data-v-953c1808]{display:none}}</style>
<style>.appFooter .info[data-v-3cec749a]{padding:20px 0}.appFooter .info .icp[data-v-3cec749a]{color:rgba(235,244,241,.5)}@media (max-width:900px){.appFooter[data-v-3cec749a] *{font-size:.8rem}}</style>
<style>header[data-v-0e66c829]{height:auto;padding-top:82px}header[data-v-0e66c829],main[data-v-0e66c829]{margin:0 auto;width:700px}main[data-v-0e66c829]{position:relative;z-index:1}footer[data-v-0e66c829]{margin:0 auto;padding:20px 0;width:700px}@media (max-width:900px){header[data-v-0e66c829]{height:48px;padding:64px 2.5vw 0}header[data-v-0e66c829],main[data-v-0e66c829]{width:calc(100vw - 40px)}main[data-v-0e66c829]{padding:0 20px}footer[data-v-0e66c829]{padding:40px 20px;width:calc(100vw - 40px)}}</style>
<style>.articleContent[data-v-f9c11d0b]{margin:0 auto;max-width:900px;min-width:100px;padding-top:32px;width:100%}.articleContent .info[data-v-f9c11d0b]{display:none}@media (max-width:900px){.articleContent[data-v-f9c11d0b]{min-width:10vw;width:100%}.articleContent .info[data-v-f9c11d0b]{display:block;margin-bottom:24px}.articleContent .info p[data-v-f9c11d0b]{margin:0}.articleContent .info .articleTitle[data-v-f9c11d0b]{font-size:1.2rem}.articleContent .info .articleTime[data-v-f9c11d0b]{font-size:.9rem}}</style>
<style>pre code .line{display:block;min-height:1rem}</style>
<link rel="stylesheet" href="/_nuxt/entry.Cprq0VW9.css">
<link rel="stylesheet" href="/_nuxt/ProsePre.CchFRBtv.css">
<link rel="preload" as="fetch" crossorigin="anonymous" href="/articles/socketusercount/_payload.json?29a55ab7-0aef-4efd-98b8-8f83f465373e">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DY8XPlMf.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/6oANVjzW.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/W6J_HCmv.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/9QRU8BnI.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/8AqZETps.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C-v3KzvZ.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dnd51l0P.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/T3wwVhFt.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CNDj2rKL.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CH7qITeT.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CgddQozM.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Yjj_B0f0.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BJYn9d5n.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Cyeyvgqd.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Cj1BaL5_.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/D0kQrnBb.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DgXCoJty.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/D8ptmpb7.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/uyllBd8X.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C2FKOXRe.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/w2HmMSmq.js">
<link rel="prefetch" as="style" crossorigin href="/_nuxt/useStudio.DQTJeWrd.css">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/CrO8Kan5.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/DJApYFC3.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/BN9OmkRG.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/DxJMK0f2.js">
<meta name="description" content="s22y's webSite">
<link rel="shortcut icon" href="/logo_small.webp">
<link rel="apple-touch-icon" href="/logo_small.webp">
<meta property="og:title" content="使用socket实现站点实时在线人数">
<script type="module" src="/_nuxt/DY8XPlMf.js" crossorigin></script>
<style>:where(.i-icon-park-solid\:bachelor-cap-two){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48' width='48' height='48'%3E%3Cg fill='none' stroke='black' stroke-linejoin='round' stroke-width='4'%3E%3Cpath d='M11 21v15.039c0 .607.274 1.18.785 1.509C13.486 38.643 17.86 41 24 41s10.514-2.357 12.215-3.452c.51-.33.785-.902.785-1.51V21'/%3E%3Cpath stroke-linecap='round' d='M43 24v8'/%3E%3Cpath fill='black' stroke-linecap='round' d='M5 17L24 7l19 10l-19 10z'/%3E%3C/g%3E%3C/svg%3E")}:where(.i-icon-park-solid\:book-one){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48' width='48' height='48'%3E%3Cg fill='none' stroke='black' stroke-linejoin='round' stroke-width='4'%3E%3Cpath fill='black' d='M7 37V11a6 6 0 0 1 6-6h22v26H13c-3.3 0-6 2.684-6 6Z'/%3E%3Cpath stroke-linecap='round' d='M35 31H13a6 6 0 0 0 0 12h28V7M14 37h20'/%3E%3C/g%3E%3C/svg%3E")}:where(.i-icon-park-solid\:railway){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48' width='48' height='48'%3E%3Cdefs%3E%3Cmask id='ipSRailway0'%3E%3Cg fill='none'%3E%3Cpath fill='%23fff' stroke='%23fff' stroke-linejoin='round' stroke-width='4' d='M12 6a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2v24a2 2 0 0 1-2 2H14a2 2 0 0 1-2-2z'/%3E%3Ccircle cx='18' cy='26' r='2' fill='%23000'/%3E%3Ccircle cx='30' cy='26' r='2' fill='%23000'/%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='4' d='M12 20h24'/%3E%3Cpath stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='4' d='M21 38h6m-9 6h12'/%3E%3Cpath stroke='%23fff' stroke-linecap='round' stroke-width='4' d='m17 32l-6 12m20-12l6 12'/%3E%3Cpath stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='4' d='M36 15v10M12 15v10'/%3E%3C/g%3E%3C/mask%3E%3C/defs%3E%3Cpath fill='black' d='M0 0h48v48H0z' mask='url(%23ipSRailway0)'/%3E%3C/svg%3E")}:where(.i-typcn\:rss){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='black' d='M6.002 15.999a2 2 0 1 0-.004 4a2 2 0 0 0 .004-4M6 4a2 2 0 0 0 0 4c5.514 0 10 4.486 10 10a2 2 0 0 0 4 0c0-7.72-6.28-14-14-14m0 6a2 2 0 0 0 0 4c2.205 0 4 1.794 4 4a2 2 0 0 0 4 0c0-4.411-3.589-8-8-8'/%3E%3C/svg%3E")}</style></head><body><div id="__nuxt"><!--[--><header data-v-0e66c829><div class="appHeader" data-v-0e66c829 data-v-953c1808><div class="content" data-v-953c1808><div class="articleInfo" data-v-953c1808><!--[--><p class="articleTitle" data-v-953c1808>使用socket实现站点实时在线人数</p><p class="articleTime" data-v-953c1808>Sep 19, 2024</p><!--]--></div><nav class="menu" data-v-953c1808><ul class="mainmenu" data-v-953c1808><li class="item" data-v-953c1808><a href="/" class="" data-v-953c1808><span class="iconify i-icon-park-solid:bachelor-cap-two icon" aria-hidden="true" style="" data-v-953c1808></span><span class="text" data-v-953c1808>Home</span></a></li><li class="item spot" data-v-953c1808>·</li><li class="item" data-v-953c1808><a href="/article" class="" data-v-953c1808><span class="iconify i-icon-park-solid:book-one icon" aria-hidden="true" style="" data-v-953c1808></span><span class="text" data-v-953c1808>article</span></a></li><li class="item spot" data-v-953c1808>·</li><li class="item" data-v-953c1808><a href="https://www.travellings.cn/go.html" rel="noopener noreferrer" target="_blank" data-v-953c1808><span class="iconify i-icon-park-solid:railway icon" aria-hidden="true" style="" data-v-953c1808></span><span class="text" data-v-953c1808>travelling</span></a></li><li class="item spot" data-v-953c1808>·</li><li class="item" data-v-953c1808><a href="/rss.xml" rel="noopener noreferrer" target="_blank" data-v-953c1808><span class="iconify i-typcn:rss icon" aria-hidden="true" style="" data-v-953c1808></span><span class="text" data-v-953c1808>RSS</span></a></li></ul></nav></div></div></header><main data-v-0e66c829><div class="articleContent" data-v-f9c11d0b><div class="info" data-v-f9c11d0b><!--[--><p class="articleTitle" data-v-f9c11d0b>使用socket实现站点实时在线人数</p><p class="articleTime" data-v-f9c11d0b>Sep 19, 2024</p><!--]--></div><!--[--><div><h1 id="写在前面"><!--[-->写在前面<!--]--></h1><p><!--[-->前段时间刷视频看到了 Mix Space 项目, 抱着好奇逛了一下, 发现页脚的实时在线人数还挺有意思, 刚好最近在重新设计博客的前后端, 就试了一下, 也成功在自己的博客实现了实时在线人数显示.<!--]--></p><p><!--[--><img src="/image/socketUserCount/1.webp" alt="1"><!--]--></p><h1 id="技术原理"><!--[-->技术原理<!--]--></h1><p><!--[-->看 Mix Space 页脚的说明可以知道用的是 WebSocket 技术, 所以这里我使用的是 socket.io 库, 稍微跟着官网的教程学一下大概就能明白是怎么实现的了.<!--]--></p><p><!--[-->在客户端渲染页面的时候会自动建立 WebSocket 连接, 服务端会在成功建立连接时记录当前连接的客户端数量, 并且 socket.io 库提供了一个 api-<a href="https://socket.io/zh-CN/docs/v4/server-api/#engineclientscount" rel="nofollow"><!--[-->engine.clientsCount<!--]--></a>用于返回连接的客户端数量.<!--]--></p><!--[--><pre class="language-javascript shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> count</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#E1E4E8"> io.engine.clientsCount;
</span></span></code><!--]--></pre><!--]--><h1 id="实操"><!--[-->实操<!--]--></h1><p><!--[-->因为我对更深层的技术也不太了解, 所以就以代码为主, 不写一些全双工,长轮询之类的复杂原理.<!--]--></p><p><!--[-->这里我用的后端是 node.js, node.js 已经能够满足我的需求了, 所以我也不追求一些更高级的编程语言写的后端了<!--]--></p><h2 id="在原有的后端加入-socketio"><a href="#在原有的后端加入-socketio"><!--[-->在原有的后端加入 socket.io<!--]--></a></h2><p><!--[-->安装:<!--]--></p><!--[--><pre class="language-shell shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#B392F0">pnpm</span><span style="--shiki-default:#9ECBFF"> add</span><span style="--shiki-default:#9ECBFF"> socket.io
</span></span></code><!--]--></pre><!--]--><p><!--[-->我这里将 socket 相关的代码全部独立出来作为一个文件, 所以正常流程会和官网的文档有些出入.<!--]--></p><!--[--><pre class="language-javascript shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// main.js
</span></span><span class="line" line="2"><span style="--shiki-default:#6A737D">// 创建 express 实例
</span></span><span class="line" line="3"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> express </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &quot;express&quot;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="4"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> service</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#B392F0"> express</span><span style="--shiki-default:#E1E4E8">();
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#6A737D">// 创建Socket实例
</span></span><span class="line" line="7"><span style="--shiki-default:#6A737D">// 这里的 ./socket.js 是我们配置 socket 的文件, 需要我们自己手动建
</span></span><span class="line" line="8"><span style="--shiki-default:#6A737D">// 在 main.js 创建的实例只是相当于导入了一个配置文件给 express 实例使用
</span></span><span class="line" line="9"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> { createSocketServer } </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &quot;./socket.js&quot;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="10"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> server</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#B392F0"> createSocketServer</span><span style="--shiki-default:#E1E4E8">(service);
</span></span></code><!--]--></pre><!--]--><!--[--><pre class="language-javascript shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// socket.io
</span></span><span class="line" line="2"><span style="--shiki-default:#6A737D">// 导入依赖
</span></span><span class="line" line="3"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> { createServer } </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &quot;node:http&quot;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="4"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> { Server } </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &quot;socket.io&quot;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#F97583">export</span><span style="--shiki-default:#F97583"> function</span><span style="--shiki-default:#B392F0"> createSocketServer</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#FFAB70">service</span><span style="--shiki-default:#E1E4E8">) {
</span></span><span class="line" line="7"><span style="--shiki-default:#6A737D">    // 创建服务器实例
</span></span><span class="line" line="8"><span style="--shiki-default:#F97583">    const</span><span style="--shiki-default:#79B8FF"> server</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#B392F0"> createServer</span><span style="--shiki-default:#E1E4E8">(service);
</span></span><span class="line" line="9"><span style="--shiki-default:#6A737D">    // 配置端口和跨域, 如果不配置端口会和 express 的实例共用一个端口, 不过我不知道为什么如果我不配置就会导致无法连接到 socket
</span></span><span class="line" line="10"><span style="--shiki-default:#F97583">    const</span><span style="--shiki-default:#79B8FF"> io</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#F97583"> new</span><span style="--shiki-default:#B392F0"> Server</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#79B8FF">3333</span><span style="--shiki-default:#E1E4E8">, {
</span></span><span class="line" line="11"><span style="--shiki-default:#E1E4E8">        cors: {
</span></span><span class="line" line="12"><span style="--shiki-default:#E1E4E8">            origin: </span><span style="--shiki-default:#9ECBFF">&quot;*&quot;</span><span style="--shiki-default:#E1E4E8">,
</span></span><span class="line" line="13"><span style="--shiki-default:#E1E4E8">        },
</span></span><span class="line" line="14"><span style="--shiki-default:#E1E4E8">    });
</span></span><span class="line" line="15"><span emptylineplaceholder="true">
</span></span><span class="line" line="16"><span style="--shiki-default:#6A737D">    // 当客户端连接时
</span></span><span class="line" line="17"><span style="--shiki-default:#E1E4E8">    io.</span><span style="--shiki-default:#B392F0">on</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;connection&quot;</span><span style="--shiki-default:#E1E4E8">, (</span><span style="--shiki-default:#FFAB70">socket</span><span style="--shiki-default:#E1E4E8">) </span><span style="--shiki-default:#F97583">=&gt;</span><span style="--shiki-default:#E1E4E8"> {
</span></span><span class="line" line="18"><span style="--shiki-default:#6A737D">        // 给客户端发送有多少人在线
</span></span><span class="line" line="19"><span style="--shiki-default:#E1E4E8">        io.</span><span style="--shiki-default:#B392F0">emit</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;user count&quot;</span><span style="--shiki-default:#E1E4E8">, io.engine.clientsCount);
</span></span><span class="line" line="20"><span emptylineplaceholder="true">
</span></span><span class="line" line="21"><span style="--shiki-default:#6A737D">        // 有客户端离线时
</span></span><span class="line" line="22"><span style="--shiki-default:#E1E4E8">        socket.</span><span style="--shiki-default:#B392F0">on</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;disconnect&quot;</span><span style="--shiki-default:#E1E4E8">, () </span><span style="--shiki-default:#F97583">=&gt;</span><span style="--shiki-default:#E1E4E8"> {
</span></span><span class="line" line="23"><span style="--shiki-default:#E1E4E8">            io.</span><span style="--shiki-default:#B392F0">emit</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;user count&quot;</span><span style="--shiki-default:#E1E4E8">, io.engine.clientsCount);
</span></span><span class="line" line="24"><span style="--shiki-default:#E1E4E8">        });
</span></span><span class="line" line="25"><span style="--shiki-default:#E1E4E8">    });
</span></span><span class="line" line="26"><span emptylineplaceholder="true">
</span></span><span class="line" line="27"><span style="--shiki-default:#F97583">    return</span><span style="--shiki-default:#E1E4E8"> server;
</span></span><span class="line" line="28"><span style="--shiki-default:#E1E4E8">}
</span></span></code><!--]--></pre><!--]--><h2 id="在前端配置-socket"><a href="#在前端配置-socket"><!--[-->在前端配置 socket<!--]--></a></h2><p><!--[-->安装:<!--]--></p><!--[--><pre class="language-shell shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#B392F0">pnpm</span><span style="--shiki-default:#9ECBFF"> add</span><span style="--shiki-default:#9ECBFF"> socket.io-client
</span></span></code><!--]--></pre><!--]--><!--[--><pre class="language-javascript shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// 在 main.js 创建实例
</span></span><span class="line" line="2"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> { io } </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &quot;socket.io-client&quot;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="3"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> socket</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#B392F0"> io</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;127.0.0.1:3333&quot;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="4"><span style="--shiki-default:#6A737D">// 这里将 socket 的实例全局挂载, 方便我们在其他组件调用 socket
</span></span><span class="line" line="5"><span style="--shiki-default:#E1E4E8">app.config.globalProperties.$socket </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> socket;
</span></span></code><!--]--></pre><!--]--><!--[--><pre class="language-javascript shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// 在组件中配置事件
</span></span><span class="line" line="2"><span style="--shiki-default:#F97583">export</span><span style="--shiki-default:#F97583"> default</span><span style="--shiki-default:#E1E4E8"> {
</span></span><span class="line" line="3"><span style="--shiki-default:#B392F0">    data</span><span style="--shiki-default:#E1E4E8">() {
</span></span><span class="line" line="4"><span style="--shiki-default:#F97583">        return</span><span style="--shiki-default:#E1E4E8"> {
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D">            // socket连接状态
</span></span><span class="line" line="6"><span style="--shiki-default:#E1E4E8">            isSocket: </span><span style="--shiki-default:#79B8FF">false</span><span style="--shiki-default:#E1E4E8">,
</span></span><span class="line" line="7"><span style="--shiki-default:#6A737D">            // 当前连接人数
</span></span><span class="line" line="8"><span style="--shiki-default:#E1E4E8">            userCount: </span><span style="--shiki-default:#9ECBFF">&quot;?&quot;</span><span style="--shiki-default:#E1E4E8">,
</span></span><span class="line" line="9"><span style="--shiki-default:#E1E4E8">        };
</span></span><span class="line" line="10"><span style="--shiki-default:#E1E4E8">    },
</span></span><span class="line" line="11"><span style="--shiki-default:#B392F0">    mounted</span><span style="--shiki-default:#E1E4E8">() {
</span></span><span class="line" line="12"><span style="--shiki-default:#6A737D">        // 负责接收连接人数
</span></span><span class="line" line="13"><span style="--shiki-default:#79B8FF">        this</span><span style="--shiki-default:#E1E4E8">.$socket.</span><span style="--shiki-default:#B392F0">on</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;user count&quot;</span><span style="--shiki-default:#E1E4E8">, (</span><span style="--shiki-default:#FFAB70">count</span><span style="--shiki-default:#E1E4E8">) </span><span style="--shiki-default:#F97583">=&gt;</span><span style="--shiki-default:#E1E4E8"> {
</span></span><span class="line" line="14"><span style="--shiki-default:#79B8FF">            this</span><span style="--shiki-default:#E1E4E8">.userCount </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> count;
</span></span><span class="line" line="15"><span style="--shiki-default:#E1E4E8">        });
</span></span><span class="line" line="16"><span style="--shiki-default:#6A737D">        // 连接成功时
</span></span><span class="line" line="17"><span style="--shiki-default:#79B8FF">        this</span><span style="--shiki-default:#E1E4E8">.$socket.</span><span style="--shiki-default:#B392F0">on</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;connect&quot;</span><span style="--shiki-default:#E1E4E8">, () </span><span style="--shiki-default:#F97583">=&gt;</span><span style="--shiki-default:#E1E4E8"> {
</span></span><span class="line" line="18"><span style="--shiki-default:#79B8FF">            this</span><span style="--shiki-default:#E1E4E8">.isSocket </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#79B8FF"> true</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="19"><span style="--shiki-default:#E1E4E8">        });
</span></span><span class="line" line="20"><span style="--shiki-default:#6A737D">        // 断开连接时
</span></span><span class="line" line="21"><span style="--shiki-default:#79B8FF">        this</span><span style="--shiki-default:#E1E4E8">.$socket.</span><span style="--shiki-default:#B392F0">on</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;disconnect&quot;</span><span style="--shiki-default:#E1E4E8">, () </span><span style="--shiki-default:#F97583">=&gt;</span><span style="--shiki-default:#E1E4E8"> {
</span></span><span class="line" line="22"><span style="--shiki-default:#79B8FF">            this</span><span style="--shiki-default:#E1E4E8">.isSocket </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#79B8FF"> false</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="23"><span style="--shiki-default:#E1E4E8">        });
</span></span><span class="line" line="24"><span style="--shiki-default:#E1E4E8">    },
</span></span><span class="line" line="25"><span style="--shiki-default:#E1E4E8">};
</span></span></code><!--]--></pre><!--]--><h2 id="反向代理"><a href="#反向代理"><!--[-->反向代理<!--]--></a></h2><p><!--[-->这里顺便说一下放进服务器里面运行, 因为我的服务器配置了 Nginx , 所以当时我把功能上线的时候遇到了很多问题, 例如 400 或者 500 , 看了官方文档才知道使用反代需要特殊配置才能使用.<!--]--></p><p><!--[-->我为了方便, 避免在开发环境和生产环境切换的时候反复手动修改, 用到了环境变量.<!--]--></p><h3 id="后端"><a href="#后端"><!--[-->后端<!--]--></a></h3><p><!--[--><code class=""><!--[-->SOCKET_PATH<!--]--></code>留空是因为在反代中我需要自定义路径, 如果不需要自定义路径可以不使用 PATH.<!--]--></p><!--[--><pre class="language-javascript shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// .env.development
</span></span><span class="line" line="2"><span style="--shiki-default:#6A737D">// 开发环境
</span></span><span class="line" line="3"><span style="--shiki-default:#79B8FF">SOCKET_PATH</span><span style="--shiki-default:#F97583"> =
</span></span><span class="line" line="4"><span style="--shiki-default:#79B8FF">SOCKET_PORT</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#79B8FF"> 3333</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#6A737D">// .env.production
</span></span><span class="line" line="7"><span style="--shiki-default:#79B8FF">SOCKET_PATH</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#9ECBFF"> /</span><span style="--shiki-default:#DBEDFF">socket</span><span style="--shiki-default:#9ECBFF">/</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="8"><span style="--shiki-default:#79B8FF">SOCKET_PORT</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#79B8FF"> 3333</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span style="--shiki-default:#6A737D">// socket.js
</span></span><span class="line" line="11"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#79B8FF"> *</span><span style="--shiki-default:#F97583"> as</span><span style="--shiki-default:#E1E4E8"> dotenv </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &quot;dotenv&quot;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="12"><span style="--shiki-default:#E1E4E8">dotenv.</span><span style="--shiki-default:#B392F0">config</span><span style="--shiki-default:#E1E4E8">();
</span></span><span class="line" line="13"><span style="--shiki-default:#6A737D">// 程序会根据情况自动切换使用对应端口
</span></span><span class="line" line="14"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> path</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#E1E4E8"> process.env.</span><span style="--shiki-default:#79B8FF">SOCKET_PATH</span><span style="--shiki-default:#F97583"> ||</span><span style="--shiki-default:#9ECBFF"> &quot;&quot;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="15"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> port</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#E1E4E8"> process.env.</span><span style="--shiki-default:#79B8FF">SOCKET_PORT</span><span style="--shiki-default:#F97583"> ||</span><span style="--shiki-default:#79B8FF"> 3333</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> io</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#F97583"> new</span><span style="--shiki-default:#B392F0"> Server</span><span style="--shiki-default:#E1E4E8">(port, {
</span></span><span class="line" line="18"><span style="--shiki-default:#E1E4E8">    path: path,
</span></span><span class="line" line="19"><span style="--shiki-default:#E1E4E8">    cors: {
</span></span><span class="line" line="20"><span style="--shiki-default:#6A737D">        // * 是通配符, 为了安全建议修改成自己的站点
</span></span><span class="line" line="21"><span style="--shiki-default:#6A737D">        /* 例如我的修改为origin:
</span></span><span class="line" line="22"><span style="--shiki-default:#6A737D">        [&quot;http://192.168.31.111:5173&quot;, &quot;https://blog.sooooooooooooooooootheby.top/&quot;]
</span></span><span class="line" line="23"><span style="--shiki-default:#6A737D">        前面的是开发环境的, 后面的是生产环境的
</span></span><span class="line" line="24"><span style="--shiki-default:#6A737D">        */
</span></span><span class="line" line="25"><span style="--shiki-default:#E1E4E8">        origin: </span><span style="--shiki-default:#9ECBFF">&quot;*&quot;</span><span style="--shiki-default:#E1E4E8">,
</span></span><span class="line" line="26"><span style="--shiki-default:#E1E4E8">    },
</span></span><span class="line" line="27"><span style="--shiki-default:#E1E4E8">});
</span></span></code><!--]--></pre><!--]--><blockquote><!--[--><p><!--[-->至于程序是怎么做到自动切换的, 我也不知道, 问问 GPT.<!--]--></p><p><!--[-->自动切换开发环境和生产环境的环境变量依赖于 process.env 对象的行为，这是 Node.js 和许多构建工具（如 Vite、Webpack）支持的一个功能，用来根据不同的运行环境加载相应的环境变量。<!--]--></p><p><!--[-->原理：<!--]--></p><p><!--[-->process.env 是一个存储环境变量的对象。不同的环境（例如开发环境和生产环境）可以通过不同的环境变量配置文件来设置不同的值，从而让代码自动适应这些环境。<!--]--></p><p><!--[-->在开发环境和生产环境中，通常使用不同的环境变量文件，例如：<!--]--></p><ul><!--[--><li><!--[-->开发环境：使用 .env.development<!--]--></li><li><!--[-->生产环境：使用 .env.production<!--]--></li><!--]--></ul><p><!--[-->构建工具（如 Vite、Webpack）会根据你运行的命令（比如 npm run serve、npm run build）选择对应的环境文件，并将其中的变量注入到 process.env 中。<!--]--></p><!--]--></blockquote><h3 id="前端"><a href="#前端"><!--[-->前端<!--]--></a></h3><!--[--><pre class="language-javascript shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// .env.development
</span></span><span class="line" line="2"><span style="--shiki-default:#79B8FF">VITE_SOCKET_URL</span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#79B8FF">192.168</span><span style="--shiki-default:#E1E4E8">.</span><span style="--shiki-default:#79B8FF">31.111</span><span style="--shiki-default:#E1E4E8">:</span><span style="--shiki-default:#79B8FF">3579
</span></span><span class="line" line="3"><span style="--shiki-default:#79B8FF">VITE_SOCKET_PATH</span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF">/</span><span style="--shiki-default:#DBEDFF">socket</span><span style="--shiki-default:#9ECBFF">/
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D">// .env.production
</span></span><span class="line" line="6"><span style="--shiki-default:#79B8FF">VITE_SOCKET_URL</span><span style="--shiki-default:#F97583">=
</span></span><span class="line" line="7"><span style="--shiki-default:#79B8FF">VITE_SOCKET_PATH</span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF">/</span><span style="--shiki-default:#DBEDFF">socket</span><span style="--shiki-default:#9ECBFF">/
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span style="--shiki-default:#6A737D">// main.js
</span></span><span class="line" line="10"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> { io } </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &quot;socket.io-client&quot;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="11"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> socketUrl</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#F97583"> import</span><span style="--shiki-default:#E1E4E8">.</span><span style="--shiki-default:#79B8FF">meta</span><span style="--shiki-default:#E1E4E8">.env.</span><span style="--shiki-default:#79B8FF">VITE_SOCKET_URL</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="12"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> socketPath</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#F97583"> import</span><span style="--shiki-default:#E1E4E8">.</span><span style="--shiki-default:#79B8FF">meta</span><span style="--shiki-default:#E1E4E8">.env.</span><span style="--shiki-default:#79B8FF">VITE_SOCKET_PATH</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="13"><span style="--shiki-default:#F97583">const</span><span style="--shiki-default:#79B8FF"> socket</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#E1E4E8"> socketUrl </span><span style="--shiki-default:#F97583">?</span><span style="--shiki-default:#B392F0"> io</span><span style="--shiki-default:#E1E4E8">(socketUrl) </span><span style="--shiki-default:#F97583">:</span><span style="--shiki-default:#B392F0"> io</span><span style="--shiki-default:#E1E4E8">({ path: socketPath });
</span></span><span class="line" line="14"><span style="--shiki-default:#E1E4E8">app.config.globalProperties.$socket </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> socket;
</span></span></code><!--]--></pre><!--]--><h3 id="nginx"><a href="#nginx"><!--[-->Nginx<!--]--></a></h3><p><!--[-->nginx的具体配置可以见<a href="https://socket.io/zh-CN/docs/v4/reverse-proxy/" rel="nofollow"><!--[-->官方文档<!--]--></a>.<!--]--></p><p><!--[-->下面的配置文件只需要修改端口号.<!--]--></p><!--[--><pre class="language-conf shiki shiki-themes github-dark" style=""><!--[--><code><span class="line" line="1"><span>location /socket/ {
</span></span><span class="line" line="2"><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span class="line" line="3"><span>        proxy_set_header Host $host;
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span>        // 这里端口号需要修改为你自己配置的 socket 的端口号
</span></span><span class="line" line="6"><span>        proxy_pass http://127.0.0.1:3333;
</span></span><span class="line" line="7"><span emptylineplaceholder="true">
</span></span><span class="line" line="8"><span>        proxy_http_version 1.1;
</span></span><span class="line" line="9"><span>        proxy_set_header Upgrade $http_upgrade;
</span></span><span class="line" line="10"><span>        proxy_set_header Connection &quot;upgrade&quot;;
</span></span><span class="line" line="11"><span>}
</span></span></code><!--]--></pre><!--]--><style>html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}</style></div><!--]--></div></main><footer data-v-0e66c829><div class="appFooter" data-v-0e66c829 data-v-3cec749a><div class="info" data-v-3cec749a><p class="copyright" data-v-3cec749a>Copyright ©2024.sooooooooooooooooootheby All rights reserved</p></div></div></footer><!--]--></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/articles/socketusercount/_payload.json?29a55ab7-0aef-4efd-98b8-8f83f465373e">[{"state":1,"once":3,"_errors":4,"serverRendered":7,"path":8,"prerenderedAt":9},["Reactive",2],{},["Set"],["ShallowReactive",5],{"content-query-ooooXck2jf":6,"content-query-HMPbOawiE4":6},null,true,"/articles/socketusercount",1730364767631]</script>
<script>window.__NUXT__={};window.__NUXT__.config={public:{mdc:{components:{prose:true,map:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"ProseCodeInline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"}},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}}},content:{locales:[],defaultLocale:"",integrity:1730364745108,experimental:{stripQueryParameters:false,advanceQuery:false,clientDB:false},respectPathCase:false,api:{baseURL:"/api/_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"ProseCodeInline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:"github-dark",highlighter:"shiki",shikiEngine:"oniguruma",langs:["js","jsx","json","ts","tsx","vue","css","html","bash","md","mdc","yaml"]},wsUrl:"",documentDriven:false,host:"",trailingSlash:false,search:"",contentHead:true,anchorLinks:{depth:4,exclude:[1]}},studio:{apiURL:"http://localhost:1337",iframeMessagingAllowedOrigins:""}},app:{baseURL:"/",buildId:"29a55ab7-0aef-4efd-98b8-8f83f465373e",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>