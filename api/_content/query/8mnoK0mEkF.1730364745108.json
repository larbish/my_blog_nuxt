{"_path":"/articles/openwrt","_dir":"articles","_draft":false,"_partial":false,"_locale":"","title":"给小米路由器刷入openWRT","description":"本文仅记录小米路由器 4A 千兆版(R4A)的刷机过程，用于参考作用。","time":"2024-7-20","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"写在前面"},"children":[{"type":"text","value":"写在前面"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"本文仅记录小米路由器 4A 千兆版(R4A)的刷机过程，用于参考作用。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"教程来自"},{"type":"element","tag":"a","props":{"href":"https://blog.learnonly.xyz/p/630b.html","rel":["nofollow"]},"children":[{"type":"text","value":"从 0 开始刷小米路由器 4a 千兆版 | 猪猪博客"}]}]},{"type":"element","tag":"h1","props":{"id":"准备工作"},"children":[{"type":"text","value":"准备工作"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"一根网线和能插网线的电脑"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"R4A 刷机工具+openWRT"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"本教程用到的所有工具和固件 "},{"type":"element","tag":"a","props":{"href":"https://www.123pan.com/s/iTK6Vv-P1hwh.html%E6%8F%90%E5%8F%96%E7%A0%81:0415","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.123pan.com/s/iTK6Vv-P1hwh.html提取码:0415"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"固件来自"},{"type":"element","tag":"a","props":{"href":"https://github.com/MrTaiKe/Action_OpenWrt_Xiaomi_R4AGv2","rel":["nofollow"]},"children":[{"type":"text","value":"GitHub - MrTaiKe/Action_OpenWrt_Xiaomi_R4AGv2: Xiaomi R4AGv2 Gigabit Router OpenWrt Breed Flash 小米路由器 R4Av2 千兆版"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ssh & ftp 连接工具，本文使用的是 xshell 和 windows 自带的资源管理器"}]}]},{"type":"element","tag":"h1","props":{"id":"开始"},"children":[{"type":"text","value":"开始"}]},{"type":"element","tag":"h2","props":{"id":"一ssh-连接"},"children":[{"type":"text","value":"一、ssh 连接"}]},{"type":"element","tag":"h3","props":{"id":"使用-powershell-解锁-ssh"},"children":[{"type":"text","value":"使用 powershell 解锁 ssh"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"输入下面的命令"}]},{"type":"element","tag":"pre","props":{"className":"language-shell shiki shiki-themes github-dark","code":".\\python.exe .\\remote_command_execution_vulnerability_v2.py\n","language":"shell","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"\\"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"python.exe"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" ."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"\\r"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"emote_command_execution_vulnerability_v2.py\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果显示了"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"telnet"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"ssh"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"ftp"}]},{"type":"text","value":"的信息就说明服务启动成功了，如果不成功可以多尝试几次。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"1","src":"/image/openWRT/1.png"},"children":[]}]},{"type":"element","tag":"h3","props":{"id":"使用-ssh-工具连接路由器"},"children":[{"type":"text","value":"使用 ssh 工具连接路由器"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我这里使用的是 xshell，主机为"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"192.168.31.1"}]},{"type":"text","value":"，用户名和密码都是"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"root"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"2","src":"/image/openWRT/2.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"二备份原厂固件"},"children":[{"type":"text","value":"二、备份原厂固件"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"登录进去后执行下面的命令，命令会将原厂固件保存到"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/tmp"}]},{"type":"text","value":"目录。"}]},{"type":"element","tag":"pre","props":{"className":"language-shell shiki shiki-themes github-dark","code":"cat /proc/mtd&&dd if=/dev/mtd0 of=/tmp/all_backup.bin\n","language":"shell","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"cat"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" /proc/mtd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"dd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" if=/dev/mtd0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" of=/tmp/all_backup.bin\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这个时候我们需要使用 ftp 工具取出固件。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我本来想使用 winSCP，但是不知道什么原因连接上了但是显示不出文件，所以直接用资源管理器了。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"将"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"all_backup.bin"}]},{"type":"text","value":"文件复制出来，这个就是刚刚保存的原厂固件。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"注意！这里要使用右键菜单中的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"复制到文件夹"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"3","src":"/image/openWRT/3.webp"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"检查文件的大小，正常情况下应该是 16M，如果非常小就说明前面的步骤可能出问题了，建议删除路由器中的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"all_backup.bin"}]},{"type":"text","value":"重新执行命令再将文件复制出来。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"4","src":"/image/openWRT/4.webp"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"三刷入不死鸟-breed"},"children":[{"type":"text","value":"三、刷入不死鸟 breed"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"使用资源管理器进入"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/tmp"}]},{"type":"text","value":"目录，将"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"breed.bin"}]},{"type":"text","value":"复制到"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/tmp"}]},{"type":"text","value":"目录下。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"5","src":"/image/openWRT/5.webp"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 shell 中检查"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"breed.bin"}]},{"type":"text","value":"的 MD5，对比 MD5 值"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"24e62762809c15ba3872e610a37451a3"}]},{"type":"text","value":"如果 MD5 值不同，请重新上传。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"6","src":"/image/openWRT/6.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"确认原厂固件"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"all_backup.bin"}]},{"type":"text","value":"备份完成以及"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"breed.bin"}]},{"type":"text","value":"上传完成后，执行以下命令刷入 breed。"}]},{"type":"element","tag":"pre","props":{"className":"language-shell shiki shiki-themes github-dark","code":"mtd write /tmp/breed.bin Bootloader\n","language":"shell","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"mtd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" write"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" /tmp/breed.bin"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" Bootloader\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这一步可能会断网，我做的时候没有断，这都是正常的。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"将连接电脑的网线从 LAN 口插到 WAN 口，绿圈的是 WAN 口，红圈是 LAN 口。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"7","src":"/image/openWRT/7.webp"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在浏览器输入"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"192.168.1.1"}]},{"type":"text","value":"进入 breed 后台。如果无法进入，将路由器断电，按住复位键，路由器通电，等待 5~10s 松开复位键，再在路由器输入"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"192.168.1.1"}]},{"type":"text","value":"，进入速度可能会有些慢，多等一会。如果长时间无法进入，可能是前面的步骤出错，检查一些自己的操作。"}]},{"type":"element","tag":"h2","props":{"id":"四刷入-openwrt"},"children":[{"type":"text","value":"四、刷入 openWRT"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在刷入 openWRT 固件前在固件备份中备份"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"编程器固件"}]},{"type":"text","value":"以及"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"EEPROM"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"8","src":"/image/openWRT/8.webp"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"打开固件更新选择你的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"openwrt.bin"}]},{"type":"text","value":"固件，或者开头我提供的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"R4AG v2"}]},{"type":"text","value":"固件，又或者是你自己的固件。在"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"EEPROM"}]},{"type":"text","value":"选择刚刚备份下来的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"eeprom.bin"}]},{"type":"text","value":"，点击刷入会跳转到一个确认页面，在这里点击上传，读条完成后路由器会自动重启。将网线从 WAN 口插回 LAN 口，在路由器输入"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"193.168.31.1"}]},{"type":"text","value":"就能进入"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"openWRT"}]},{"type":"text","value":"了（这里进入时间可能会比较慢，建议多等一两分钟）。默认的用户名密码是"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"root/password"}]},{"type":"text","value":"，如果不对自行询问固件作者。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"(选择固件的截图忘记截了)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"9","src":"/image/openWRT/9.webp"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"10","src":"/image/openWRT/10.jpg"},"children":[]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"一ssh-连接","depth":2,"text":"一、ssh 连接","children":[{"id":"使用-powershell-解锁-ssh","depth":3,"text":"使用 powershell 解锁 ssh"},{"id":"使用-ssh-工具连接路由器","depth":3,"text":"使用 ssh 工具连接路由器"}]},{"id":"二备份原厂固件","depth":2,"text":"二、备份原厂固件"},{"id":"三刷入不死鸟-breed","depth":2,"text":"三、刷入不死鸟 breed"},{"id":"四刷入-openwrt","depth":2,"text":"四、刷入 openWRT"}]}},"_type":"markdown","_id":"content:articles:openWRT.md","_source":"content","_file":"articles/openWRT.md","_stem":"articles/openWRT","_extension":"md"}